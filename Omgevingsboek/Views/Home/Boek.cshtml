@model Models.OmgevingsBoek_Models.Boek

@{
    ViewBag.Title = "Boeken";
}

<div class="col-xs-6 col-md-9 content" id="content">
    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#activiteiten" aria-controls="activiteiten" role="tab" data-toggle="tab">Activiteiten</a></li>
        <li onclick="resizeMap();" role="presentation"><a href="#routes" aria-controls="routes" role="tab" data-toggle="tab">Routes</a></li>
    </ul>
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade in active" id="activiteiten">
            <div class="row books" id="mijnBoeken">
                <h3 class="rowheader">@Model.Naam</h3>
                @*<ol class="breadcrumb list-inline">
                    <li><a href="@Url.Action("Index","Home")"><span class="glyphicon glyphicon-home"></span></a></li>
                    <li class="active">Boek: @Model.Naam</li>
                    </ol>*@
                @foreach (Models.OmgevingsBoek_Models.Activiteit activiteit in Model.Activiteiten)
                {
                    <div class="col-sm-6 col-md-3">
                        <a href="#">
                            <img class="img-responsive" src="@activiteit.AfbeeldingNaam" />
                            <span class="caption">@activiteit.Naam</span>
                        </a>
                        <span class="buttons">
                            <a href="/home/Activiteit?id=@activiteit.Id&action=share" class="expand btn btn-default" type="button"><span class="glyphicon glyphicon-share"></span></a>
                            <a href="/home/Activiteit?id=@activiteit.Id&action=public" class="expand btn btn-default" type="button"><span class="glyphicon glyphicon-eye-close"></span></a>
                            <a href="/home/Activiteit?id=@activiteit.Id&action=settings" class="expand btn btn-default" type="button"><span class="glyphicon glyphicon-cog"></span></a>
                        </span>
                    </div>
                }
                <div class="col-sm-6 col-md-3">
                    <a href="#" class="toggleActivityForm">
                        <span class="caption"><span class="glyphicon glyphicon-plus"></span> Activiteit toevoegen</span>
                    </a>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="routes">
            <div class="row books" id="mijnBoeken">
                <h3 class="rowheader">Routes</h3>


                <div class="col-md-6 col-xs-12 col-lg-6">
                    @*<input id="pac-input" class="controls" type="text" placeholder="Voer een locatie in" />*@
                    <div id="map-canvas"></div>
                </div>
                <div class="col-md-6 col-xs-12 col-lg-6">
                    <select size="5" id="waypointsList">
                        <option disabled>Klik op een POI om te starten</option>
                    </select>
                </div>
                <div class="col-md-6 col-xs-12 col-lg-6"></div>
                <div class="col-md-6 col-xs-12 col-lg-6">
                    <button class="btn btn-default btn-primary">
                        Route berekenen
                    </button>
                    <button class="btn btn-default" id="moveWaypointUp">
                        <span class="glyphicon glyphicon-arrow-up"></span>Naar boven
                    </button>
                    <button class="btn btn-default" id="moveWaypointDown">
                        <span class="glyphicon glyphicon-arrow-down"></span>Naar beneden
                    </button>
                    <button onclick="removeWaypointFromList()" class="btn btn-danger">
                        <span class="glyphicon glyphicon-remove"></span>Verwijder punt
                    </button>
                    <button class="btn btn-danger">
                        <span class="glyphicon glyphicon-remove"></span>Verwijder route
                    </button>
                </div>


            </div>
        </div>
    </div>
</div>

<div class="col-xs-6 col-md-9 content" id="activityForm" style="
  position: absolute;
  height: 99%;
  top:0;
  overflow-y:auto !important; /*fuck jquery*/
  bottom:0;
  display: none;
  background-color: white;
    -webkit-transition: none;
    -moz-transition: none;
    -ms-transition: none;
    -o-transition: none;
">
    @using (Html.BeginForm("AddActivity", "Home", FormMethod.Post, new { enctype = "multipart/form-data", data_toggle = "validator" }))
    {
        <div class="row">
            <div class="col-md-5">
                <div class="form-group">
                    <label for="naam">Naam:</label><span class="help-block with-errors"></span>
                    <input type="text" class="form-control" id="name" name="Naam" placeholder="Naam van activiteit" required>
                </div>
                <div class="form-group">
                    <label for="PoiShow">POI:</label><span class="help-block with-errors"></span>
                    <input type="text" name="PoiShow" class="form-control" id="poiName" placeholder="Klik op de afbeelding van een POI." readonly>
                    <input type="text" class="form-control hidden-input" id="poi" name="PoiId" required>
                </div>
            </div>
            <div class="form-group col-md-6">
                <label for="amount">Tags:</label>
                <div class="input-group">
                    <span class="input-group-addon tag"><span class="glyphicon glyphicon-tags"></span></span>
                    <input name="TagsString" class="form-control tags" id="poiTags" value="" />
                </div>
            </div>
            <div class="col-md-1">
                <button class="toggleActivityForm btn btn-danger">
                    <span class="caption"><span class="glyphicon glyphicon-remove"></span></span>
                </button>
            </div>

        </div>

        <div class="row">
            <div role="tabpanel" class="col-md-12">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#basis" aria-controls="basis" role="tab" data-toggle="tab">Basis info</a></li>
                    <li role="presentation"><a href="#media" aria-controls="media" role="tab" data-toggle="tab">Media</a></li>
                </ul>
                <!-- Tab panes -->
                @Html.Hidden("BoekId", Model.Id)
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="basis">
                        <div class="row">
                            <div class="form-group col-md-4">
                                <label for="amount">Leeftijd doelgroep:</label>
                                <input type="hidden" class="form-control" id="amount" readonly style="">
                                <div class="input-group">
                                    <span class="input-group-addon" id="minAgeBoek"></span>
                                    <div class="form-control slider" id="slider-boek-age"></div>
                                    <span class="input-group-addon" id="maxAgeBoek"></span>
                                    <input type="hidden" name="MaxLeeftijd" id="maxAgeHiddenBoek" />
                                    <input type="hidden" name="MinLeeftijd" id="minAgeHiddenBoek" />

                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="amount">Geschatte tijdsduur:</label>
                                <input type="hidden" class="form-control" id="amount" readonly style="">
                                <div class="input-group">
                                    <span class="input-group-addon" id="minTimeBook"></span>
                                    <div class="form-control" class="slider" id="slider-boek-time"></div>
                                    <span class="input-group-addon" id="maxTimeBook"></span>
                                    <input type="hidden" name="MaxDuur" id="maxTimeHiddenBook" />
                                    <input type="hidden" name="MinDuur" id="minTimeHiddenBook" />

                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="amount">Prijs per leerling:</label>
                                <div class="input-group">
                                    <span class="input-group-addon">&euro;</span>
                                    <input class="form-control" pattern="[0-9]+([,][0-9]+)?" fuckyouasp type="text" id="prijsLeerling" name="Prijs">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label for="amount">Toelichting:</label>
                                <textarea class="form-control" type="text" id="prijsLeerling" name="DitactischeToelichting"></textarea>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="amount">Uitleg activiteit:</label>
                                <textarea class="form-control" type="text" id="prijsLeerling" name="Uitleg"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-12">
                                <label for="amount">Benodigdheden:</label>
                                <div class="input-group">
                                    <span class="input-group-addon tag"><span class="glyphicon glyphicon-shopping-cart"></span></span>
                                    <input name="BenodigdhedenString" class="form-control shopping" id="poiTags" value="" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="media">
                        <h3>Video</h3>
                        <div class="upload_video">
                            <div class="row">
                                <div class="form-group col-md-12">
                                    <span id="signinButton" class="pre-sign-in">
                                        <!-- IMPORTANT: Replace the value of the <code>data-clientid</code>
                                        attribute in the following tag with your project's client ID. -->
                                        <span class="g-signin"
                                              data-callback="signinCallback"
                                              data-clientid="373280989230-i785digcek4jpfhtg802a4el59jsfv1t.apps.googleusercontent.com"
                                              data-cookiepolicy="single_host_origin"
                                              data-scope="https://www.googleapis.com/auth/youtube.upload https://www.googleapis.com/auth/youtube">
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div class="post-sign-in">
                                <div class="row">
                                    <div class="form-group col-md-3" id="profile-show">
                                        <span id="channel-name"></span>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="title">Benaming:</label>
                                        <input id="title" class="form-control" type="text" placeholder="Titel van video">
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="description">Beschrijving:</label>
                                        <textarea class="form-control" id="description"></textarea>
                                        <div>
                                            <select hidden id="privacy-status">
                                                <option>public</option>
                                                <option selected>unlisted</option>
                                                <option>private</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="file">Uploaden:</label>
                                        <input input type="file" id="file" class="button form-control" accept="video/*">
                                        <button class="btn btn-default form-control" id="button">Video uploaden</button>
                                        <div class="during-upload">
                                            <p><span id="percent-transferred"></span>% done (<span id="bytes-transferred"></span>/<span id="total-bytes"></span> bytes)</p>
                                            <progress id="upload-progress" max="1" value="0"></progress>
                                        </div>
                                        <div class="post-upload">
                                            <input class="form-control" disabled name="video" id="video-id" />
                                            <p>De video is geupload. (<a id="video-url" href="#"></a>)</p>
                                            <ul hidden id="post-upload-status"></ul>
                                            <div id="player"></div>
                                        </div>
                                    </div>
                                    <script src="//apis.google.com/js/client:plusone.js"></script>
                                    <script src="~/Scripts/cors_upload.js"></script>
                                    <script src="~/Scripts/upload_video.js"></script>
                                </div>
                            </div>
                        </div>
                        <h3>Afbeeldingen</h3>
                        <div class="row">
                            <div class="form-group col-md-12 upload">
                                <label for="images">Kies afbeeldingen: (tip: je kan meerdere afbeeldingen tegelijk selecteren)</label>
                                <div class="fileUpload btn btn-default form-control">
                                    <span>Upload Foto</span>
                                    <input type="file" multiple class="upload" name="images" id="images" accept="image/x-png, image/gif, image/jpeg">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-md-12">
                        <button type="submit" class="btn btn-success form-control" data-loading-text='<i class="fa fa-spinner fa-pulse"></i>' >
                            <span class="glyphicon glyphicon-ok" />
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<div class="col-xs-6 col-md-9 content" id="routeForm" style="
  position: absolute;
  height: 99%;
  top:0;
  overflow-y:auto !important; /*fuck jquery*/
  bottom:0;
  display: none;
  background-color: white;
    -webkit-transition: none;
    -moz-transition: none;
    -ms-transition: none;
    -o-transition: none;
    transition:none;
">
    @using (Html.BeginForm("AddRoute", "Home", FormMethod.Post, new { enctype = "multipart/form-data", data_toggle = "validator" }))
    {
        <div class="row">
            <div class="form-group col-md-11">
                <input type="text" name="naam" class="form-control" />
            </div>
            <div class="form-group col-md-1">
                <button class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span></button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label>Weg</label>
            </div>
            <div class="col-md-4">
                <label>Geschatte tijdsduur: <span id="timeEstimate">4u</span></label>
            </div>
            <div class="col-md-4">
                <label>Totale kostprijs per leerling: <span id="costEstimate">€10</span></label>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-12">
                <button class="btn btn-success form-control"><span class="glyphicon glyphicon-ok"></span></button>
            </div>
        </div>
    }
</div>

<script>

    function resizeMap() {
        setTimeout(resizeMapActual, 500);
    }
    function resizeMapActual() {
        google.maps.event.trigger(map, 'resize');
    }

    var ageSlider;
    var timeSlider;

    $(".toggleActivityForm").click(function (e) {
        e.preventDefault();
        $("#activityForm").slideToggle(400, function () {
        });
    });

    function initSliders() {
        setSliderInputValues(
            $("#minTimeBook"),
            $("#maxTimeBook"),
            $("#minTimeHiddenBook"),
            $("#maxTimeHiddenBook"),
            0,
            24
        );

        setSliderInputValues(
            $("#minAgeBoek"),
            $("#maxAgeBoek"),
            $("#minAgeHiddenBoek"),
            $("#maxAgeHiddenBoek"),
            0,
            18
        );

        ageSlider = setSliderValues(
            $("#slider-boek-age"),
            $("#minAgeBoek"),
            $("#maxAgeBoek"),
            $("#minAgeHiddenBoek"),
            $("#maxAgeHiddenBoek"),
            0,
            18
        );

        timeSlider = setSliderValues(
            $("#slider-boek-time"),
            $("#minTimeBook"),
            $("#maxTimeBook"),
            $("#minTimeHiddenBook"),
            $("#maxTimeHiddenBook"),
            0,
            24
        );
    }

    function setSliderValues(sliderEl, minShow, maxShow, minHidden, maxHidden, minVal, maxVal) {
        return sliderEl.slider({
            range: true,
            min: minVal,
            max: maxVal,
            values: [minVal, maxVal],
            slide: function (event, ui) {
                setSliderInputValues(minShow, maxShow, minHidden, maxHidden, ui.values[0], ui.values[1]);
                console.log("slider changed");
            }
        });
    }

    function moveSliders(sliderEl, minVal, maxVal) {
        sliderEl.slider("values", [minVal, maxVal]);
    }

    function setSliderInputValues(minShow, maxShow, minHidden, maxHidden, minVal, maxVal) {
        minShow.text(minVal);
        maxShow.text(maxVal);
        minHidden.val(minVal);
        maxHidden.val(maxVal);
    }

    function setListItemListeners() {
        $("#list .row.poi").each(
         function (element) {
             var poi = this;


             $(this).children(".preview").click(
               function (element) {
                   tagSel = json.filter(function (el) { return el.poi.ID == $(poi).attr("data-id") })[0];
                   if ($('#activityForm').css("display") !== 'none') {
                       console.log("activity form displayed");

                       $("#poi").val(tagSel.poi.ID);
                       $("#poiName").val(tagSel.poi.Naam);
                       console.log(tagSel.poi.MaxLeeftijd);
                       console.log(tagSel.poi.MinLeeftijd);
                       moveSliders($("#slider-boek-age"), tagSel.poi.MinLeeftijd, tagSel.poi.MaxLeeftijd);
                       setSliderInputValues(
                            $("#minAgeBoek"),
                            $("#maxAgeBoek"),
                            $("#minAgeHiddenBoek"),
                            $("#maxAgeHiddenBoek"),
                            tagSel.poi.MinLeeftijd,
                            tagSel.poi.MaxLeeftijd
                        );

                       $("#prijsLeerling").val(tagSel.poi.Prijs);
                   } else if ($('#routes').hasClass("active") == true) {
                       console.log("Route form displayed");
                       console.log(tagSel.poi);


                       var attr = $("#waypointsList option:first-child").attr('disabled');
                       //check if list is empty or
                       if (typeof attr !== typeof undefined && attr !== false) {
                           // lijst leegmaken
                           console.log("lijst leegmaken");
                           $("#waypointsList").children().remove();
                       }
                       $("#waypointsList").append($('<option>', {
                           value: /*hier moet de lat & lng inkomen voor de berekening van de route*/ 0,
                           text: tagSel.poi.Naam
                       }));

                       marker = new google.maps.Marker({
                           position: /*TODO: Use actual location here*/new google.maps.LatLng(50, 3.01),
                           map: map
                       });
                       map.setCenter(new google.maps.LatLng(50, 3.01));
                       map.setZoom(9);
                       markerArray.push(marker);


                   }
               });

         });

        $("#activityForm input:file").change(function () {
            var fileName = $(this).val();
            console.log(fileName);
            $("#activityForm .fileUpload").toggleClass("upload-ok");
            //$(".filename").html(fileName);
        });
    }

    function deferListener(method) {
        console.log("lel");
        if (typeof listLoaded !== 'undefined' && listLoaded == true) {
            method();
            listLoaded = false;
            $('#searchPoi').bind('input', function () {
                method();
            });
        } else
            setTimeout(function () { deferListener(method) }, 50);
    }

    deferListener(setListItemListeners);
    initSliders();
</script>

<script src="~/Content/js/GoogleMapsScript.js"></script>

@*@Html.Partial("_PoiPartial", Model)*@
@{ Html.RenderAction("PoiPartial", "Home"); }
