@model Models.OmgevingsBoek_Models.Boek

@{
    ViewBag.Title = "Boeken";
}

<div class="col-xs-6 col-md-9 content" id="content">
    <div class="row books" id="mijnBoeken"> 
        <h3 class="rowheader">@Model.Naam</h3>
        @*<ol class="breadcrumb list-inline">
            <li><a href="@Url.Action("Index","Home")"><span class="glyphicon glyphicon-home"></span></a></li>
            <li class="active">Boek: @Model.Naam</li>
        </ol>*@
        @foreach (Models.OmgevingsBoek_Models.Activiteit activiteit in Model.Activiteiten)
        {
            <div class="col-sm-6 col-md-3">
                <a href="#">
                    <img class="img-responsive" src="@activiteit.AfbeeldingNaam" />
                    <span class="caption">@activiteit.Naam</span>
                </a>
                <span class="buttons">
                    <a href="/home/Activiteit?id=@activiteit.Id&action=share" class="expand btn btn-default" type="button"><span class="glyphicon glyphicon-share"></span></a>
                    <a href="/home/Activiteit?id=@activiteit.Id&action=public" class="expand btn btn-default" type="button"><span class="glyphicon glyphicon-eye-close"></span></a>
                    <a href="/home/Activiteit?id=@activiteit.Id&action=settings" class="expand btn btn-default" type="button"><span class="glyphicon glyphicon-cog"></span></a>
                </span>
            </div>
        }
        <div class="col-sm-6 col-md-3">
            <a href="#" class="toggleActivityForm">
                <span class="caption"><span class="glyphicon glyphicon-plus"></span> Activiteit toevoegen</span>
            </a>
        </div>
    </div>
</div>

<div class="col-xs-6 col-md-9 content" id="activityForm" style="
  position: absolute;
  height: 99%;
  top:0;
  overflow-y:auto !important; /*fuck jquery*/
  bottom:0;
  display: none;
  background-color: white;
    -webkit-transition: none;
    -moz-transition: none;
    -ms-transition: none;
    -o-transition: none;
">
    @using (Html.BeginForm("AddActivity", "Home", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <div class="row">
            <div class="col-md-4">
                <label for="amount">Naam:</label>
                <input type="text" class="form-control" id="name" name="Naam" placeholder="Naam van activiteit">
                <label for="amount">POI:</label>
                <input type="text" class="form-control" id="poiName" placeholder="Klik op de afbeelding van een POI." disabled>
                <input type="hidden" class="form-control" id="poi" name="PoiId">
            </div>
            <div class="form-group col-md-5">
                <label for="amount">Tags:</label>
                <div class="input-group">
                    <span class="input-group-addon tag"><span class="glyphicon glyphicon-tags"></span></span>
                    <input name="TagsString" class="form-control tags" id="poiTags" value="" />
                </div>
            </div>
            <div class="form-group col-md-2 upload">
                <label for="inputFile">Upload afbeelding</label>
                <div class="fileUpload btn btn-default form-control">
                    <span>Upload Foto</span>
                    <input type="file" class="upload" name="AfbeeldingFile" id="exampleInputFile" accept="image/x-png, image/gif, image/jpeg">
                </div>
            </div>
            <div class="col-md-1">
                <button class="toggleActivityForm btn btn-danger">
                    <span class="caption"><span class="glyphicon glyphicon-remove"></span></span>
                </button>
            </div>

        </div>
        <div class="row">
            <div role="tabpanel" class="col-md-12">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#basis" aria-controls="basis" role="tab" data-toggle="tab">Basis info</a></li>
                    <li role="presentation"><a href="#media" aria-controls="media" role="tab" data-toggle="tab">Media</a></li>
                </ul>
                <!-- Tab panes -->
                @Html.Hidden("BoekId",Model.Id)
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="basis">
                        <div class="row">
                            <div class="form-group col-md-4">
                                <label for="amount">Leeftijd doelgroep:</label>
                                <input type="hidden" class="form-control" id="amount" readonly style="">
                                <div class="input-group">
                                    <span class="input-group-addon" id="minAgeBoek"></span>
                                    <div class="form-control slider" id="slider-boek-age"></div>
                                    <span class="input-group-addon" id="maxAgeBoek"></span>
                                    <input type="hidden" name="MaxLeeftijd" id="maxAgeHiddenBoek" />
                                    <input type="hidden" name="MinLeeftijd" id="minAgeHiddenBoek" />

                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="amount">Geschatte tijdsduur:</label>
                                <input type="hidden" class="form-control" id="amount" readonly style="">
                                <div class="input-group">
                                    <span class="input-group-addon" id="minTimeBook"></span>
                                    <div class="form-control" class="slider" id="slider-boek-time"></div>
                                    <span class="input-group-addon" id="maxTimeBook"></span>
                                    <input type="hidden" name="MaxDuur" id="maxTimeHiddenBook" />
                                    <input type="hidden" name="MinDuur" id="minTimeHiddenBook" />

                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="amount">Prijs per leerling:</label>
                                <div class="input-group">
                                    <span class="input-group-addon">&euro;</span>
                                    <input class="form-control" pattern="[0-9]+([,][0-9]+)?" type="number" id="prijsLeerling" step="0,1" name="Prijs">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label for="amount">Toelichting:</label>
                                <textarea class="form-control" type="text" id="prijsLeerling" name="DitactischeToelichting"></textarea>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="amount">Uitleg activiteit:</label>
                                <textarea class="form-control" type="text" id="prijsLeerling" name="Uitleg"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-12">
                                <label for="amount">Benodigdheden:</label>
                                <div class="input-group">
                                    <span class="input-group-addon tag"><span class="glyphicon glyphicon-shopping-cart"></span></span>
                                    <input name="BenodigdhedenString" class="form-control shopping" id="poiTags" value="" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="media">
                        <img src="http://cdn.yourepeat.com/media/gif/000/910/431/a34fc2a47ddc1137b324afa006daac9d.gif" />
                             amai mijn gedacht!</div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-12">
                <button type="submit" class="btn btn-success form-control" data-loading-text='<i class="fa fa-spinner fa-pulse"></i>'>
                    <span class="glyphicon glyphicon-ok" />
            </button>
            </div>
        </div>
    }
</div>

<script>

    var ageSlider;
    var timeSlider;

    $(".toggleActivityForm").click(function (e) {
        e.preventDefault();
        $("#activityForm").slideToggle(400, function () {
        });
    });

    function initSliders() {
        setSliderInputValues(
            $("#minTimeBook"),
            $("#maxTimeBook"),
            $("#minTimeHiddenBook"),
            $("#maxTimeHiddenBook"),
            0,
            24
        );

        setSliderInputValues(
            $("#minAgeBoek"),
            $("#maxAgeBoek"),
            $("#minAgeHiddenBoek"),
            $("#maxAgeHiddenBoek"),
            0,
            18
        );

        ageSlider = setSliderValues(
            $("#slider-boek-age"),
            $("#minAgeBoek"),
            $("#maxAgeBoek"),
            $("#minAgeHiddenBoek"),
            $("#maxAgeHiddenBoek"),
            0,
            18
        );

        timeSlider = setSliderValues(
            $("#slider-boek-time"),
            $("#minTimeBook"),
            $("#maxTimeBook"),
            $("#minTimeHiddenBook"),
            $("#maxTimeHiddenBook"),
            0,
            24
        );
    }

    function setSliderValues(sliderEl, minShow, maxShow, minHidden, maxHidden, minVal, maxVal) {
        return sliderEl.slider({
            range: true,
            min: minVal,
            max: maxVal,
            values: [minVal, maxVal],
            slide: function (event, ui) {
                setSliderInputValues(minShow, maxShow, minHidden, maxHidden, ui.values[0], ui.values[1]);
                console.log("slider changed");
            }
        });
    }

    function moveSliders(sliderEl, minVal, maxVal) {
        sliderEl.slider("values", [minVal, maxVal]);
    }

    function setSliderInputValues(minShow, maxShow, minHidden, maxHidden, minVal, maxVal) {
        minShow.text(minVal);
        maxShow.text(maxVal);
        minHidden.val(minVal);
        maxHidden.val(maxVal);
    }

    function setListItemListeners() {
        $("#list .row.poi").each(
         function (element) {
             var poi = this;
             $(this).children(".preview").click(
               function (element) {
                   tagSel = json.filter(function (el) { return el.poi.ID == $(poi).attr("data-id") })[0];
                   $("#poi").val(tagSel.poi.ID);
                   $("#poiName").val(tagSel.poi.Naam);
                   console.log(tagSel.poi.MaxLeeftijd);
                   console.log(tagSel.poi.MinLeeftijd);

                   moveSliders($("#slider-boek-age"), tagSel.poi.MinLeeftijd, tagSel.poi.MaxLeeftijd);
                   setSliderInputValues(
                        $("#minAgeBoek"),
                        $("#maxAgeBoek"),
                        $("#minAgeHiddenBoek"),
                        $("#maxAgeHiddenBoek"),
                        tagSel.poi.MinLeeftijd,
                        tagSel.poi.MaxLeeftijd
                    );

                   $("#prijsLeerling").val(tagSel.poi.Prijs);
               }
             );
         });

        $("#activityForm input:file").change(function () {
            var fileName = $(this).val();
            console.log(fileName);
            $("#activityForm .fileUpload").toggleClass("upload-ok");
            //$(".filename").html(fileName);
        });
    }

    function deferListener(method) {
        console.log("lel");
        if (typeof listLoaded !== 'undefined' && listLoaded == true) {
                method();
                listLoaded = false;
                $('#searchPoi').bind('input', function () {
                    method();
                });
        } else
            setTimeout(function () { deferListener(method)}, 50);
    }

    deferListener(setListItemListeners);

    initSliders();
</script>

@*@Html.Partial("_PoiPartial", Model)*@

@{ Html.RenderAction("PoiPartial", "Home"); }
