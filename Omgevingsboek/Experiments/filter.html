<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Filter Experiment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="fuse.js"></script>
</head>
<body>
    <img src="http://media.giphy.com/media/6LonKWAWPmwpO/giphy.gif">
    <h1>allahu akbar!</h1>
    <input type="text" id="search" placeholder="tag:lol" />
    <div id="list"></div>
    <script>
        //Test data
        var json = [
  {
    "poi": {
      "Eigenaar": null,
      "Tags": [
        {
          "Activiteiten": null,
          "Pois": [],
          "ID": 1,
          "Naam": "Museum"
        },
        {
          "Activiteiten": null,
          "Pois": [],
          "ID": 2,
          "Naam": "geschiedenis"
        },
        {
          "Activiteiten": null,
          "Pois": [],
          "ID": 3,
          "Naam": "Brugge"
        },
        {
          "Activiteiten": null,
          "Pois": [],
          "ID": 4,
          "Naam": "panorama"
        }
      ],
      "ID": 1,
      "Naam": "Gentpoort",
      "EigenaarId": "13d768d6-fb4c-46b9-bb0a-73c8e7014652",
      "Afbeelding": "18259403910",
      "GeoLocatie": null,
      "Email": "musea@brugge.be",
      "Telefoon": "+32 50 44 87 43",
      "Straat": "Gentpoortstraat",
      "Nummer": "48",
      "Gemeente": "Brugge",
      "Postcode": 8000,
      "MinLeeftijd": 9,
      "MaxLeeftijd": 12,
      "Prijs": 0.0
    },
    "Afbeelding": "https://farm9.staticflickr.com/8840/18259403910_6138f0a862.jpg"
  },
  {
    "poi": {
      "Eigenaar": null,
      "Tags": [
        {
          "Activiteiten": null,
          "Pois": [],
          "ID": 5,
          "Naam": "Molen"
        }
      ],
      "ID": 2,
      "Naam": "Sint-Janshuismolen",
      "EigenaarId": "13d768d6-fb4c-46b9-bb0a-73c8e7014652",
      "Afbeelding": "18420708676",
      "GeoLocatie": null,
      "Email": "musea@brugge.be",
      "Telefoon": "+32 50 44 87 43",
      "Straat": "Kruisvest",
      "Nummer": "",
      "Gemeente": "Brugge",
      "Postcode": 8000,
      "MinLeeftijd": 11,
      "MaxLeeftijd": 11,
      "Prijs": 0.0
    },
    "Afbeelding": "https://farm9.staticflickr.com/8888/18420708676_0fda078f15.jpg"
  }
]

        var filtered = json;

        $('#search').bind('input', function () {
            filter($(this).val());
        });

        function filter(query) {
            filtered = json;

            var matcher = /(\S+:\S+)/gi;

            var options = {
              caseSensitive: true,
              includeScore: false,
              shouldSort: false,
              threshold: 0.6,
              location: 0,
              distance: 100,
              maxPatternLength: 32,
              keys: ["naam"]
            };

            filters = [];
            match = matcher.exec(query);
            while (match != null) {
                if (match != null) { filters.push(match[1]); }
                match = matcher.exec(query);
            }

            //Vind property matchers, e.g. tag:zwemmen
            filters.forEach(function (filter) {
                prop = filter.split(":")[0];
                val = filter.split(":")[1];

                filtered = filtered.filter(function (el) {

                    if(el[prop] == null) { return false; }
                    var fuse = new Fuse([el[prop]], options);
                    var res = fuse.search(val);
                    if(res[0] != null){
                        return true;
                    }
                    return false;
                });
            })

            //Zoek op texts die geen property matchers zijn
            var fuse = new Fuse(filtered, options);
            if(query.replace(matcher, "").replace(" ", "") != ""){
               var filtered = fuse.search(query.replace(matcher, ""));
            }

            //Verwijder huidige nodes en vervang door nieuwe items
            while (document.getElementById("list").firstChild) {
                document.getElementById("list").removeChild(document.getElementById("list").firstChild);
            }
            filtered.forEach(function (home) {
                var node = document.createElement("LI");     
                var textnode = document.createTextNode("Tag: " + home.tag);         
                node.appendChild(textnode); 
                textnode = document.createTextNode(", Naam: " + home.naam);         
                node.appendChild(textnode);                                
                document.getElementById("list").appendChild(node);
            });
        }

        filter("");
    </script>
</body>
</html>